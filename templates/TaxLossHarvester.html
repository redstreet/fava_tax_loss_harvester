{% import "_query_table.html" as querytable with context %}

{% set qharvestable = 'SELECT LEAF(account),
        units(sum(position)) as units,
        cost_number as cost,
        first(getprice(currency, cost_currency)) as price,
        cost(sum(position)) as book_value,
        value(sum(position)) as market_value,
        cost_date as acquisition_date
      WHERE account_sortkey(account) ~ "^[01]" AND
        account ~ "Assets:Investments"
      GROUP BY LEAF(account), cost_date, currency, cost_currency, cost_number, account_sortkey(account)
      ORDER BY account_sortkey(account), currency, cost_date'
%}


<h2>Tax Loss Harvester</h2>
<br />

{% set retval = extension.harvestable(None, None) %}
<h3>{{retval[0][0]}}</h3>
{{ querytable.querytable(None, *retval[0][1]) }}

